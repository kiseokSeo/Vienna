<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.sample.vienna.mapper.MemberMapper">

	<!-- 전체 내용 조회 -->
	<select id="login"
		resultType="com.sample.vienna.domain.MemberVO"
		parameterType="com.sample.vienna.domain.MemberVO"> <!-- 받는값 -->
		select
			member_code as memCode,
			id as id,
			pass as pass,
			member_name as memName,
			member_level as memLevel,
			email as email,
			address as address,
			address2 as address2,
			phone as phone,
			phone2 as phone2,
			phone3 as phone3,
			session_key as sessionKey,
			session_limit as sessionLimit
		from member
		where id= #{id} and pass = #{pass}
	</select>
	
	<update id="keepLogin">
        update member set session_key = #{sessionKey}, session_limit = #{sessionLimit} where id=#{id}
    </update>
    
	<select id="checkUserWithSessionKey" resultType="com.sample.vienna.domain.MemberVO" parameterType="com.sample.vienna.domain.MemberVO">
        select * from member where session_key = #{sessionId} and sessionLimit > sysdate
    </select>
    
    <select id="idCheck" resultType="int" parameterType="com.sample.vienna.domain.MemberVO">
    	select count(*) as idCnt
		from   member
		where  id = #{id}
    </select>
    
    <insert id="insertMember" parameterType="com.sample.vienna.domain.MemberVO">
    	insert into member
		(
		   member_code,
		   id,
		   pass,
		   member_name,
		   member_level,
		   email,
		   address,
		   address2,
		   phone,
		   phone2,
		   phone3
		)
		values
		(
		   (select lpad((select count(1) + 1 from member), 5,'0') from dual),
		   #{id},
		   #{pass},
		   #{memName},
		   'A',
		   #{email},
		   #{address},
		   #{address2},
		   #{phone},
		   #{phone2},
		   #{phone3}
		)
    </insert>
</mapper>